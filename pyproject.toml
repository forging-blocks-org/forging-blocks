[tool.poetry]
name = "building-blocks"
version = "0.1.0"
description = "Composable toolkit for clean, testable, and maintainable Python applications"
authors = ["Glauber Brennon <glauberbrennon@gmail.com>"]
license = "MIT"
readme = "README.md"
packages = [{ include = "building_blocks", from = "src" }]
keywords = [
    "python library",
    "clean architecture",
    "hexagonal architecture",
    "domain-driven design",
    "ddd",
    "framework-agnostic",
    "software architecture",
    "software design",
    "software engineering",
    "ports and adapters",
    "adapter pattern",
    "application service",
    "repository pattern",
    "message bus",
    "notifier pattern",
    "data mapper",
    "result pattern",
    "result monad",
    "ok",
    "err",
    "either type",
    "debuggable",
    "use case",
    "domain layer",
    "application layer",
    "presentation layer",
    "foundation",
    "building blocks",
]

[tool.poetry.dependencies]
python = "^3.12"

[tool.poetry.group.dev.dependencies]
mypy = "^1.16.1"
ruff = "^0.14.3"
black = "^25.1.0"
pytest = "^8.3.3"
pytest-cov = "^5.0.0"
pytest-asyncio = "^0.25.0"
bandit = "^1.7.10"
pre-commit = "^4.2.0"
pyright = "^1.1.404"
poethepoet = "^0.37.0"

[tool.poetry.group.docs.dependencies]
mkdocs = "^1.6.1"
mkdocs-material = "^9.6.23"
mkdocstrings = { extras = ["python"], version = "^0.30.1" }
mkdocs-gen-files = "^0.5.0"
mkdocs-literate-nav = "^0.6.2"
mkdocs-section-index = "^0.3.10"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"

[tool.ruff]
target-version = "py312"
line-length = 100
src = ["src", "tests", "scripts"]
fix = true
extend-exclude = ["site"]  # Ignore MkDocs build directory

[tool.ruff.lint]
select = ["E", "W", "F", "I", "B", "C4", "D"]
ignore = [
    "D203",  # No blank line before class (conflicts with D211)
    "D213",  # Multi-line summary on second line (Google prefers same line)
    "B008",  # Function call in default arg
    "D105",  # Magic methods like __repr__, __eq__, etc. (MOVED HERE)
    "D106",  # Nested classes (MOVED HERE)
    "D107",  # __init__ docstring (MOVED HERE)
]

[tool.ruff.lint.pydocstyle]
convention = "google"

[tool.ruff.lint.isort]
known-first-party = ["building_blocks"]

[tool.ruff.lint.per-file-ignores]
"tests/**/*" = ["D"]  # Ignore docstring rules in tests

[tool.ruff.format]
quote-style = "double"
indent-style = "space"
docstring-code-format = true

[tool.mypy]
python_version = "3.12"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
disallow_incomplete_defs = true
check_untyped_defs = true
no_implicit_optional = true
warn_redundant_casts = true
warn_unused_ignores = true
strict_equality = true
mypy_path = "src"

[[tool.mypy.overrides]]
module = "tests.*"
ignore_missing_imports = true
disallow_untyped_defs = false

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
asyncio_mode = "auto"
addopts = [
    "--strict-markers",
    "--strict-config",
    "--cov=building_blocks",
    "--cov-report=term-missing",
]

[tool.coverage.run]
omit = [
    "*/__init__.py",
    "src/building_blocks/foundation/debuggable.py",
    "src/building_blocks/foundation/mapper.py",
    "src/building_blocks/foundation/result_mapper.py",
    "src/building_blocks/application/ports/inbound/message_handler.py",
    "src/building_blocks/application/ports/inbound/use_case.py",
    "src/building_blocks/application/ports/outbound/message_bus.py",
    "src/building_blocks/application/ports/outbound/repository.py",
    "src/building_blocks/application/ports/outbound/notifier.py",
]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "@(abc\\.)?abstractmethod",
    "@abstractmethod",
    "raise NotImplementedError",
]

[tool.poe.tasks]
lint = "ruff check ."
"lint:docs" = "ruff check --select D100,D101,D102,D103,D104"
format.sequence = [
  { cmd = "ruff check . --fix" },
  { cmd = "ruff check --select D --fix --unsafe-fixes" },
]
"format:docstrings" = "ruff check --select D --fix --unsafe-fixes"
mypy = "mypy --config-file pyproject.toml src tests scripts"
bandit = "bandit -r src -x tests"
pre-commit = "pre-commit run --all-files"
test = "pytest -q"
"test:quick" = "pytest -x -q"
"test:strict" = "pytest -x --strict-markers"
"test:nocov" = "pytest -q --no-cov"
"mkdocs:serve" = "mkdocs serve"
"mkdocs:build" = "mkdocs build"
"mkdocs:deploy" = "mkdocs gh-deploy --clean"
"docs:check" = [
  { cmd = "ruff check --select D" },
  { cmd = "mkdocs build --strict" },
]
